{"version":3,"file":"index.js","mappings":"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","sources":["webpack://WangEditorPluginMD/webpack/universalModuleDefinition","webpack://WangEditorPluginMD/external umd {\"commonjs\":\"@wangeditor/editor\",\"commonjs2\":\"@wangeditor/editor\",\"amd\":\"@wangeditor/editor\",\"root\":\"wangEditor\"}","webpack://WangEditorPluginMD/webpack/bootstrap","webpack://WangEditorPluginMD/webpack/runtime/define property getters","webpack://WangEditorPluginMD/webpack/runtime/hasOwnProperty shorthand","webpack://WangEditorPluginMD/webpack/runtime/make namespace object","webpack://WangEditorPluginMD/./src/module/plugin.ts","webpack://WangEditorPluginMD/./src/module/index.ts","webpack://WangEditorPluginMD/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@wangeditor/editor\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@wangeditor/editor\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WangEditorPluginMD\"] = factory(require(\"@wangeditor/editor\"));\n\telse\n\t\troot[\"WangEditorPluginMD\"] = factory(root[\"wangEditor\"]);\n})(self, (__WEBPACK_EXTERNAL_MODULE__857__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__857__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * @description plugin\n * @author wangfupeng\n */\n\nimport { SlateRange, SlateEditor, SlateTransforms, SlateElement } from '@wangeditor/editor'\nimport { DomEditor, IDomEditor } from '@wangeditor/editor'\n\n// 空格对应的 md 关键字\nconst KEY_TO_TYPE_FOR_SPACE: { [key: string]: string } = {\n  '*': 'list-item',\n  '-': 'list-item',\n  '+': 'list-item',\n  '>': 'blockquote',\n  '#': 'header1',\n  '##': 'header2',\n  '###': 'header3',\n  '####': 'header4',\n  '#####': 'header5',\n}\n\n// 回车对应的 md 关键字\nconst KEY_TO_TYPE_FOR_ENTER: { [key: string]: string } = {\n  '---': 'divider',\n  '----': 'divider',\n  '-----': 'divider',\n  '------': 'divider',\n\n  // PS： '```' 转换 pre/code 比较麻烦，单独写\n}\n\n/**\n * 获取 md 关键字和关键字的 range\n * @param editor editor\n */\nfunction getBeforeText(editor: IDomEditor): { beforeText: string; range: SlateRange | null } {\n  const { selection } = editor\n  if (selection == null) return { beforeText: '', range: null }\n  const { anchor } = selection\n  // 找到当前文本上面的 block 元素，如 header1 paragraph\n  const block = SlateEditor.above(editor, {\n    match: n => SlateEditor.isBlock(editor, n),\n  })\n  if (block == null) return { beforeText: '', range: null }\n  const blockPath = block[1]\n  const blockStart = SlateEditor.start(editor, blockPath) // block 元素的起始位置，就第一个文字的位置\n  const range = { anchor, focus: blockStart }\n  const beforeText = SlateEditor.string(editor, range) || ''\n  return { beforeText, range }\n}\n\nfunction withMarkdown<T extends IDomEditor>(editor: T) {\n  const { insertBreak, insertText } = editor\n  const newEditor = editor\n\n  // 输入空格时，尝试转换 markdown\n  newEditor.insertText = text => {\n    const { selection } = editor\n    if (selection == null) return insertText(text)\n    if (SlateRange.isExpanded(selection)) return insertText(text)\n    if (DomEditor.getSelectedNodeByType(editor, 'paragraph') == null) return insertText(text) // 必须在 paragraph 内\n    if (text !== ' ') return insertText(text) // 必须是输入空格\n\n    // 获取空格前面的文字\n    const { beforeText, range } = getBeforeText(editor)\n    if (!beforeText || !range) return insertText(text)\n\n    // 根据 md 关键字，找到要转换 elem 的 type\n    const type = KEY_TO_TYPE_FOR_SPACE[beforeText]\n    if (!type) return insertText(text)\n\n    // 转换为 type elem\n    SlateTransforms.select(editor, range)\n    SlateTransforms.delete(editor)\n    const props: Partial<SlateElement> = {\n      type,\n    }\n    SlateTransforms.setNodes<SlateElement>(editor, props, {\n      match: n => SlateEditor.isBlock(editor, n),\n    })\n\n    // 如果是 list-item ，则包裹一层 bulleted-list\n    if (type === 'list-item') {\n      const listElem = {\n        type: 'bulleted-list',\n        children: [],\n      }\n      SlateTransforms.wrapNodes(editor, listElem, {\n        match: n => DomEditor.getNodeType(n) === 'list-item',\n      })\n    }\n  }\n\n  // 换行时，尝试转换 markdown\n  newEditor.insertBreak = () => {\n    const { selection } = editor\n    if (selection == null) return insertBreak()\n    if (SlateRange.isExpanded(selection)) return insertBreak()\n    if (DomEditor.getSelectedNodeByType(editor, 'paragraph') == null) return insertBreak() // 必须在 paragraph 内\n\n    const { beforeText, range } = getBeforeText(editor) // 获取前面的文字\n    if (!beforeText || !range) return insertBreak()\n\n    // 单独处理 pre/code\n    if (beforeText.indexOf('```') === 0) {\n      let lang = beforeText.slice(3).toLowerCase().trim() // 获取 ```js 中的语言，如 js\n      if (lang === 'js') lang = 'javascript'\n      if (lang === 'ts') lang = 'typescript'\n      if (lang === 'md') lang = 'markdown'\n      if (lang === 'py') lang = 'python'\n      if (lang === 'vb') lang = 'visual-basic'\n      if (lang === 'c#') lang = 'csharp'\n\n      const { codeLangs = [] } = (editor.getConfig().MENU_CONF || {}).codeSelectLang || []\n      if (lang) {\n        // lang 有可能不在支持范围之内\n        const isValid = codeLangs.some((item: any) => item.value === lang)\n        if (!isValid) return insertBreak()\n      }\n\n      // 删除 ```js 文字\n      SlateTransforms.select(editor, range)\n      SlateTransforms.delete(editor)\n\n      // 插入 pre/code elem\n      const preElem = {\n        type: 'pre',\n        children: [\n          {\n            type: 'code',\n            language: lang,\n            children: [{ text: '' }],\n          },\n        ],\n      }\n      SlateTransforms.insertNodes(editor, preElem)\n      return\n    }\n\n    // 根据 md 关键字，找到要转换 elem 的 type\n    const type = KEY_TO_TYPE_FOR_ENTER[beforeText]\n    if (!type) return insertBreak()\n\n    // 转换为 type elem\n    SlateTransforms.select(editor, range)\n    SlateTransforms.delete(editor)\n    const props: Partial<SlateElement> = {\n      type,\n    }\n    SlateTransforms.setNodes<SlateElement>(editor, props, {\n      match: n => SlateEditor.isBlock(editor, n),\n    })\n  }\n\n  return newEditor\n}\n\nexport default withMarkdown\n","/**\n * @description module entry\n * @author wangfupeng\n */\n\nimport { IModuleConf } from '@wangeditor/editor'\n\nimport withMarkdown from './plugin'\n\nconst module: Partial<IModuleConf> = {\n  editorPlugin: withMarkdown,\n}\n\nexport default module\n","/**\n * @description src entry\n * @author wangfupeng\n */\n\nimport module from './module/index'\n\nexport default module\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__857__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","KEY_TO_TYPE_FOR_SPACE","KEY_TO_TYPE_FOR_ENTER","getBeforeText","editor","selection","beforeText","range","anchor","block","SlateEditor","match","n","blockPath","focus","editorPlugin","insertBreak","insertText","newEditor","text","SlateRange","DomEditor","type","SlateTransforms","props","children","indexOf","slice","toLowerCase","trim","getConfig","MENU_CONF","codeSelectLang","some","item","preElem","language"],"sourceRoot":""}